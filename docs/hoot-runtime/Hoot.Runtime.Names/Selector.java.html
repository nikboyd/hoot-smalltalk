<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Selector.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hoot-runtime</a> &gt; <a href="index.source.html" class="el_package">Hoot.Runtime.Names</a> &gt; <span class="el_source">Selector.java</span></div><h1>Selector.java</h1><pre class="source lang-java linenums">package Hoot.Runtime.Names;

import java.util.*;

import Hoot.Runtime.Maps.Library;
import Hoot.Runtime.Emissions.NamedItem;
import Hoot.Runtime.Emissions.Emission;
import Hoot.Runtime.Emissions.EmissionSource;
import static Hoot.Runtime.Names.Keyword.*;
import static Hoot.Runtime.Emissions.Emission.*;
import static Hoot.Runtime.Faces.Logging.*;
import static Hoot.Runtime.Functions.Utils.*;

/**
 * A method name (Smalltalk selector).
 *
 * @author nik &lt;nikboyd@sonic.net&gt;
 * @see &quot;Copyright 1999,2021 Nikolas S Boyd.&quot;
 * @see &quot;Permission is granted to copy this work provided this copyright statement is retained in all copies.&quot;
 */
public class Selector extends NamedItem implements Hoot.Runtime.Faces.Selector, EmissionSource {

<span class="fc" id="L23">    public Selector() { super(null); contents = new StringBuffer(); }</span>
<span class="fc" id="L24">    public static Selector named(String name) { return from(name); }</span>

    /**
     * @return a new selector created from the supplied name
     * @param name a selector name.
     */
    public static Selector from(String name) {
<span class="fc" id="L31">        Selector selector = new Selector();</span>
<span class="fc" id="L32">        selector.append(name);</span>
<span class="fc" id="L33">        return selector;</span>
    }

    /**
     * @return the number of operands in a message involving the selector.
     * @param selector a selector
     */
    public static int operandCountFrom(String selector) {
<span class="nc bnc" id="L41" title="All 2 branches missed.">        if (Name.BinaryOperators.containsKey(selector)) {</span>
<span class="nc" id="L42">            return 2;</span>
        }
<span class="nc" id="L44">        return countMatches(selector, Colon) + 1;</span>
    }

    StringBuffer contents;
<span class="fc" id="L48">    public String contents() { return contents.toString(); }</span>
<span class="fc" id="L49">    public String methodName() { return Name.from(contents()); }</span>
<span class="nc" id="L50">    public String asPrimitiveOperator() { return (String) PrimitiveOperators.get(contents()); }</span>
<span class="fc" id="L51">    public void append(String aString) { contents.append(aString); }</span>

<span class="nc" id="L53">    public boolean isAssign() { return contents().equals(Assign); }</span>
<span class="nc" id="L54">    public boolean isKeyword() { return contents().endsWith(Colon); }</span>
<span class="nc" id="L55">    public boolean isBasicNew() { return contents().startsWith(&quot;basicNew&quot;); }</span>
<span class="nc" id="L56">    public boolean isNew() { return contents().startsWith(&quot;new&quot;); }</span>

<span class="fc" id="L58">    @Override public String toString() { return contents(); }</span>
<span class="fc" id="L59">    @Override public String name() { return methodName(); }</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">    @Override public boolean isEmpty() { return contents.length() == 0; }</span>
    @Override public boolean isSelfish() {
<span class="nc bnc" id="L62" title="All 4 branches missed.">        return contents().startsWith(Super) || contents().startsWith(Self); }</span>

<span class="nc" id="L64">    public boolean isOperator() { return Name.BinaryOperators.containsKey(contents()); }</span>
<span class="nc" id="L65">    @Override public boolean isPrimitive() { return PrimitiveOperators.containsKey(contents()); }</span>
<span class="nc" id="L66">    @Override public boolean isOptimized() { return ObjectSelectors.contains(contents()); }</span>

<span class="nc" id="L68">    public boolean isReturn() { return contents().equals(Exit); }</span>
<span class="nc" id="L69">    public int operandCount() { return operandCountFrom(contents()); }</span>

<span class="nc" id="L71">    public Emission emitQuotedMethodName() { return emitQuoted(methodName()); }</span>

    @Override public Class&lt;?&gt; toClass() {
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">        return Name.isQualified(fullName()) ?</span>
<span class="fc" id="L75">            Hoot.Runtime.Faces.Selector.super.toClass() :</span>
<span class="nc" id="L76">            nullOr(f -&gt; f.primitiveClass(), Library.findFace(fullName())); }</span>

<span class="nc" id="L78">    @Override public int hashCode() { return contents().hashCode(); }</span>
    @Override public boolean equals(Object selector) {
<span class="nc bnc" id="L80" title="All 2 branches missed.">        return hasAny(selector) &amp;&amp;</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">            Hoot.Runtime.Faces.Selector.class.isAssignableFrom(selector.getClass()) &amp;&amp;</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">            falseOr(s -&gt; contents().equals(s.toString()), (Hoot.Runtime.Faces.Selector)selector); }</span>


<span class="fc" id="L85">    public static final Selector empty = Selector.from(Empty);</span>
    public static final String Assign = &quot;:=&quot;;
<span class="fc" id="L87">    public static final Selector forAssignment = Selector.from(Assign);</span>
    public static final String Exit = &quot;^&quot;;
<span class="fc" id="L89">    public static final Selector forExit = Selector.from(Exit);</span>

    public static final char COLON = ':';
    static final String Colon = &quot;:&quot;;

    static final char UNDER = '_';
    static final String Under = &quot;_&quot;;

    static final char DOLLAR = '$';
    static final String Dollar = &quot;$&quot;;

<span class="fc" id="L100">    static final Properties PrimitiveOperators = new Properties();</span>
<span class="fc" id="L101">    static final List&lt;String&gt; ObjectSelectors = emptyList(String.class);</span>

    /**
     * Initializes (reservedWords), (binaryOperators), (controlClasses).
     */
    static {
<span class="fc" id="L107">        PrimitiveOperators.put(&quot;&amp;&quot;, &quot; &amp; &quot;);</span>
<span class="fc" id="L108">        PrimitiveOperators.put(&quot;|&quot;, &quot; | &quot;);</span>
<span class="fc" id="L109">        PrimitiveOperators.put(&quot;+&quot;, &quot; + &quot;);</span>
<span class="fc" id="L110">        PrimitiveOperators.put(&quot;+=&quot;, &quot; += &quot;);</span>
<span class="fc" id="L111">        PrimitiveOperators.put(&quot;-&quot;, &quot; - &quot;);</span>
<span class="fc" id="L112">        PrimitiveOperators.put(&quot;-=&quot;, &quot; -= &quot;);</span>
<span class="fc" id="L113">        PrimitiveOperators.put(&quot;*&quot;, &quot; * &quot;);</span>
<span class="fc" id="L114">        PrimitiveOperators.put(&quot;*=&quot;, &quot; *= &quot;);</span>
<span class="fc" id="L115">        PrimitiveOperators.put(&quot;/&quot;, &quot; / &quot;);</span>
<span class="fc" id="L116">        PrimitiveOperators.put(&quot;%&quot;, &quot; % &quot;);</span>
<span class="fc" id="L117">        PrimitiveOperators.put(&quot;/=&quot;, &quot; /= &quot;);</span>
<span class="fc" id="L118">        PrimitiveOperators.put(&quot;//&quot;, &quot; / &quot;);</span>
<span class="fc" id="L119">        PrimitiveOperators.put(&quot;\\\\&quot;, &quot; % &quot;);</span>
<span class="fc" id="L120">        PrimitiveOperators.put(&quot;==&quot;, &quot; == &quot;);</span>
<span class="fc" id="L121">        PrimitiveOperators.put(&quot;&lt;&quot;, &quot; &lt; &quot;);</span>
<span class="fc" id="L122">        PrimitiveOperators.put(&quot;&lt;=&quot;, &quot; &lt;= &quot;);</span>
<span class="fc" id="L123">        PrimitiveOperators.put(&quot;&gt;&quot;, &quot; &gt; &quot;);</span>
<span class="fc" id="L124">        PrimitiveOperators.put(&quot;&gt;=&quot;, &quot; &gt;= &quot;);</span>
<span class="fc" id="L125">        PrimitiveOperators.put(&quot;~~&quot;, &quot; != &quot;);</span>
<span class="fc" id="L126">        PrimitiveOperators.put(Assign, &quot; = &quot;); // ??</span>

<span class="fc" id="L128">        ObjectSelectors.add(&quot;class&quot;);</span>
<span class="fc" id="L129">        ObjectSelectors.add(&quot;new&quot;);</span>
<span class="fc" id="L130">        ObjectSelectors.add(&quot;new:&quot;);</span>
<span class="fc" id="L131">        ObjectSelectors.add(&quot;==&quot;);</span>
<span class="fc" id="L132">        ObjectSelectors.add(&quot;~~&quot;);</span>
<span class="fc" id="L133">        ObjectSelectors.add(&quot;=&quot;);</span>
<span class="fc" id="L134">        ObjectSelectors.add(&quot;~=&quot;);</span>
<span class="fc" id="L135">        ObjectSelectors.add(&quot;do:&quot;);</span>
<span class="fc" id="L136">        ObjectSelectors.add(&quot;hash&quot;);</span>
<span class="fc" id="L137">        ObjectSelectors.add(&quot;hashCode&quot;);</span>
<span class="fc" id="L138">        ObjectSelectors.add(&quot;value&quot;);</span>
<span class="fc" id="L139">        ObjectSelectors.add(&quot;yourself&quot;);</span>
<span class="fc" id="L140">        ObjectSelectors.add(&quot;species&quot;);</span>
<span class="fc" id="L141">        ObjectSelectors.add(&quot;isNil&quot;);</span>
<span class="fc" id="L142">        ObjectSelectors.add(&quot;notNil&quot;);</span>
<span class="fc" id="L143">        ObjectSelectors.add(Assign);</span>
<span class="fc" id="L144">    }</span>

} // Selector
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>