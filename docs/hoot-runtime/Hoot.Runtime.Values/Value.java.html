<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Value.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hoot-runtime</a> &gt; <a href="index.source.html" class="el_package">Hoot.Runtime.Values</a> &gt; <span class="el_source">Value.java</span></div><h1>Value.java</h1><pre class="source lang-java linenums">package Hoot.Runtime.Values;

import Hoot.Runtime.Faces.Named;
import static Hoot.Runtime.Functions.Utils.*;
import static Hoot.Runtime.Faces.Logging.*;
import static Hoot.Runtime.Names.Keyword.Self;
import static Hoot.Runtime.Names.Primitive.*;

/**
 * A named typed value.
 * @param &lt;V&gt; a value type
 *
 * @author nik &lt;nikboyd@sonic.net&gt;
 * @see &quot;Copyright 2010,2021 Nikolas S Boyd.&quot;
 * @see &quot;Permission is granted to copy this work provided this copyright statement is retained in all copies.&quot;
 */
public class Value&lt;V&gt; implements Named {

<span class="fc" id="L19">    private Value() { super(); }</span>
<span class="fc" id="L20">    private &lt;T&gt; Value(Class&lt;T&gt; valueType) { this(); this.valueType = valueType; }</span>
<span class="fc" id="L21">    private &lt;T&gt; Value(Class&lt;T&gt; valueType, String valueName) { this(valueType); name(valueName); }</span>
<span class="nc" id="L22">    private Value(String name, V value) { this(value.getClass()); this.value = value; name(name); }</span>

<span class="fc" id="L24">    public static &lt;T&gt; Value&lt;T&gt; self(T value) { return named(Self, value); }</span>
<span class="fc" id="L25">    public static &lt;T&gt; Value&lt;T&gt; with(T value) { return named(Empty, value); }</span>
<span class="fc" id="L26">    public static &lt;T&gt; Value&lt;T&gt; from(int index) { return named(&quot;value&quot;+index); }</span>
<span class="fc" id="L27">    public static &lt;T&gt; Value&lt;T&gt; named(String name) { return new Value&lt;&gt;(Object.class, name); }</span>
<span class="nc" id="L28">    public static &lt;T&gt; Value&lt;T&gt; named(String name, Class&lt;T&gt; valueType) { return new Value&lt;&gt;(valueType, name); }</span>
    public static &lt;T&gt; Value&lt;T&gt; named(String name, T value) {
<span class="pc bpc" id="L30" title="1 of 2 branches missed.">        if (hasNone(value)) return named(name);</span>
<span class="fc" id="L31">        Value&lt;T&gt; v = new Value&lt;&gt;(value.getClass(), name);</span>
<span class="fc" id="L32">        return v.bind(value); }</span>

<span class="fc" id="L34">    private Object value = null;</span>
<span class="fc" id="L35">    private void value(Object value) { checkType(value); this.value = value; this.valueType = value.getClass(); }</span>
<span class="fc" id="L36">    @Override public &lt;R&gt; R value() { Class&lt;R&gt; resultType = resultType(valueType()); return resultType.cast(value); }</span>
<span class="pc bpc" id="L37" title="1 of 2 branches missed.">    public &lt;T extends V&gt; Value&lt;V&gt; bind(T value) { if (hasOne(value)) value(value); return this; }</span>

<span class="pc bpc" id="L39" title="1 of 2 branches missed.">    public static &lt;R&gt; R as(Class&lt;R&gt; resultType, Value v) { return hasOne(v) ? resultType.cast(v.value()) : null; }</span>
<span class="fc" id="L40">    public static &lt;V&gt; Value&lt;V&gt; asValue(Class&lt;Value&lt;V&gt;&gt; valueType, Value v) { return valueType.cast(v); }</span>

<span class="fc" id="L42">    private Class&lt;?&gt; valueType = Void.class;</span>
<span class="fc" id="L43">    @Override public Class&lt;?&gt; valueType() { return this.valueType; }</span>
<span class="pc bpc" id="L44" title="1 of 2 branches missed.">    private boolean voidType() { return Void.class == valueType(); }</span>

<span class="nc bnc" id="L46" title="All 4 branches missed.">    private void checkType(Class&lt;?&gt; aType) { if (hasOne(value) &amp;&amp; !aType.isInstance(value)) reportType(value, aType); }</span>
    private void checkType(Object value) {
<span class="pc bpc" id="L48" title="2 of 6 branches missed.">        if (hasOne(value) &amp;&amp; !voidType() &amp;&amp; !valueType().isInstance(value)) reportType(value, value.getClass()); }</span>

    static final String TypeWarning = &quot;change? %s =&gt; %s '%s'&quot;;
    private void reportType(Object value, Class&lt;?&gt; aType) {
<span class="fc" id="L52">        warn(format(TypeWarning, toString(), aType.getSimpleName(), value.toString())); }</span>

<span class="fc" id="L54">    private String valueName = Empty;</span>
<span class="fc" id="L55">    @Override public String name() { return this.valueName; }</span>
<span class="fc" id="L56">    private void inferName() { this.valueName = inferName(valueType); }</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">    private Value orInferName() { if (isEmpty(name())) inferName(); return this; }</span>
<span class="fc" id="L58">    private Value name(String valueName) { this.valueName = valueName; return this.orInferName(); }</span>
<span class="fc" id="L59">    public Value makeSelfish() { this.valueName = Self; return this; }</span>

    static final String ValueReport = &quot;%s %s: %s&quot;;
    @Override public String toString() {
<span class="fc" id="L63">        return format(ValueReport, valueType().getSimpleName(), name(), formatValue(value(), valueType())); }</span>

    static final String Comma = &quot;, &quot;;
    static final String Arrayed = &quot;[]&quot;;
    private static &lt;ValueType&gt; String formatValue(ValueType value, Class&lt;?&gt; valueType) {
<span class="fc bfc" id="L68" title="All 2 branches covered.">        if (value == null) return &quot;null&quot;;</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">        if (valueType.getSimpleName().endsWith(Arrayed)) {</span>
<span class="fc" id="L70">            Object[] values = (Object[]) value;</span>
<span class="fc" id="L71">            return joinWith(Comma, map(wrap(values), v -&gt; formatValue(v, v.getClass())));</span>
        }

<span class="fc bfc" id="L74" title="All 2 branches covered.">        if (valueType.getSimpleName().contains(String.class.getSimpleName())) {</span>
<span class="fc" id="L75">            return quoteLiterally(value.toString());</span>
        }

<span class="fc" id="L78">        return value.toString();</span>
    }

    static final String Array = &quot;Array&quot;;
    static final String Vowels = &quot;aeiou&quot;;
<span class="fc" id="L83">    static final String[] Articles = { &quot;a&quot;, &quot;an&quot; };</span>
    static String inferName(Class&lt;?&gt; valueType) {
<span class="fc" id="L85">        String typeName = valueType.getSimpleName();</span>
<span class="fc" id="L86">        String letter = Character.toString(typeName.charAt(0));</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">        int index = Vowels.contains(letter.toLowerCase()) ? 1 : 0;</span>
<span class="fc" id="L88">        String result = Articles[index] + typeName;</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">        if (typeName.endsWith(Arrayed)) result = result.replace(Arrayed, Array);</span>
<span class="fc" id="L90">        return result; }</span>

} // Value&lt;ValueType&gt;
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>