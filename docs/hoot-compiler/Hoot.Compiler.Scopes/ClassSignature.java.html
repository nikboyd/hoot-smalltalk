<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClassSignature.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hoot-compiler</a> &gt; <a href="index.source.html" class="el_package">Hoot.Compiler.Scopes</a> &gt; <span class="el_source">ClassSignature.java</span></div><h1>ClassSignature.java</h1><pre class="source lang-java linenums">package Hoot.Compiler.Scopes;

import java.util.*;
import Hoot.Runtime.Names.*;
import Hoot.Runtime.Notes.*;
import Hoot.Runtime.Behaviors.*;
import Hoot.Runtime.Emissions.*;
import static Hoot.Runtime.Names.Keyword.*;
import static Hoot.Runtime.Functions.Utils.*;
import static Hoot.Runtime.Emissions.Emission.*;
import static Hoot.Runtime.Names.TypeName.JavaRoot;

/**
 * A class definition signature.
 *
 * @author nik &lt;nikboyd@sonic.net&gt;
 * @see &quot;Copyright 2010,2021 Nikolas S Boyd.&quot;
 * @see &quot;Permission is granted to copy this work provided this copyright statement is retained in all copies.&quot;
 */
public class ClassSignature extends NamedItem implements ScopeSource {

<span class="fc" id="L22">    public ClassSignature() { super(Scope.current()); }</span>
    public static ClassSignature with(
            DetailedType superClass, DetailedType subtype, TypeList heritage,
            NoteList notes, String keyword, String comment) {
<span class="fc" id="L26">        ClassSignature result = new ClassSignature();</span>
<span class="fc" id="L27">        result.notes = notes;</span>
<span class="fc" id="L28">        result.types = heritage;</span>
<span class="fc" id="L29">        result.superClass = superClass;</span>
<span class="fc" id="L30">        result.subclass = subtype;</span>
<span class="fc" id="L31">        result.keyword = keyword;</span>
<span class="fc" id="L32">        result.comment = comment;</span>
<span class="fc" id="L33">        return result;</span>
    }

    @Override public ClassSignature metaSignature() {
<span class="fc" id="L37">        ClassSignature result = new ClassSignature();</span>
<span class="pc bpc" id="L38" title="1 of 2 branches missed.">        if (faceScope().isMetaclassBase()) return result;</span>
<span class="fc" id="L39">        result.types = TypeList.withDetails(types().listMetaTypes());</span>
<span class="fc" id="L40">        result.superClass = superMetaType();</span>
<span class="fc" id="L41">        result.subclass = DetailedType.MetaClass;</span>
<span class="fc" id="L42">        result.keyword = keyword;</span>
<span class="fc" id="L43">        return result;</span>
    }

<span class="fc" id="L46">    @Override public int hashCode() { return subType().hashCode() ^ superHash(); }</span>
    @Override public boolean equals(Object sign) {
<span class="nc bnc" id="L48" title="All 6 branches missed.">        return hasAny(sign) &amp;&amp; getClass() == sign.getClass() &amp;&amp; falseOr(s -&gt; this.equals(s), (ClassSignature) sign); }</span>

    protected boolean equals(ClassSignature s) {
<span class="nc bnc" id="L51" title="All 2 branches missed.">        if (!subType().equals(s.subType())) return false;</span>
<span class="nc bnc" id="L52" title="All 4 branches missed.">        if (!hasSuperclass()) return !s.hasSuperclass();</span>
<span class="nc" id="L53">        return superType().equals(s.superType()); }</span>

    protected String comment;
<span class="nc" id="L56">    @Override public String comment() { return this.comment; }</span>

    protected String keyword;
<span class="nc" id="L59">    public String subtypeKeyword() { return this.keyword; }</span>

    protected TypeList types;
<span class="fc" id="L62">    public TypeList types() { return this.types; }</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">    public Emission metaFaces() { return (types().isEmpty() ? null : types().emitMetaNames()); }</span>
    public Emission faces() {
<span class="fc" id="L65">        List&lt;Emission&gt; faces = types().detailedTypesCode();</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">        return (faces.isEmpty() ? null : emitList(faces));</span>
    }

    protected DetailedType subclass;
<span class="fc" id="L70">    public DetailedType subType() { return this.subclass; }</span>
<span class="fc" id="L71">    public String subclassName() { return subType().typeName().name(); }</span>
<span class="fc" id="L72">    public TypeList details() { return subType().details(); }</span>

<span class="fc" id="L74">    @Override public String description() { return name() + &quot; -&gt; &quot; + baseName(); }</span>
<span class="fc" id="L75">    @Override public String name() { return subclassName(); }</span>
<span class="fc" id="L76">    @Override public String shortName() { return name(); }</span>
<span class="fc" id="L77">    @Override public String fullName() { return faceScope().fullName(); }</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">    @Override public String baseName() { return !hasSuperclass() ? Empty : superType().toTypeName().fullName(); }</span>

    protected DetailedType superClass;
<span class="fc" id="L81">    public DetailedType superType() { return this.superClass; }</span>
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">    public int superHash() { return hasSuperclass() ? superType().hashCode() : 0; }</span>
<span class="fc" id="L83">    public boolean hasSuperclass() { return hasAny(superType()); }</span>
<span class="nc bnc" id="L84" title="All 4 branches missed.">    @Override public boolean hasNoHeritage() { return !hasSuperclass() &amp;&amp; types().isEmpty(); }</span>

<span class="pc bpc" id="L86" title="1 of 2 branches missed.">    public Emission superClass() { return (hasSuperclass() ? superType().emitItem() : emitObject()); }</span>
    public Emission superMetaClass() {
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">        if (!hasSuperclass()) return emitObject();</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">        if (Keyword.Object.equals(subclassName())) return emitItem(MetaclassBase);</span>
<span class="fc" id="L90">        return superType().emitMetaName(false);</span>
    }

    private DetailedType superMetaType() {
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">        if (!hasSuperclass()) return null;</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">        return JavaRoot.getName().equals(superClass.simpleName()) ?</span>
<span class="fc" id="L96">                DetailedType.with(Global.with(MetaclassBase)) :</span>
<span class="fc" id="L97">                DetailedType.with(Global.with(superClass.simpleName(), MetaclassType));</span>
    }

    @Override public List&lt;Typified&gt; simpleHeritage() {
<span class="fc" id="L101">        ArrayList&lt;Typified&gt; results = emptyList(Typified.class);</span>
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">        if (!hasSuperclass()) return results;</span>

<span class="fc" id="L104">        Typified superior = superior();</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">        if (reportWhetherKnown(&quot;simpleHeritage&quot;, superior, baseName())) {</span>
<span class="fc" id="L106">            results.add(superior);</span>
<span class="fc" id="L107">            results.addAll(superior.simpleHeritage());</span>
        }

<span class="fc" id="L110">        return results;</span>
    }

    @Override public List&lt;Typified&gt; typeHeritage() {
<span class="fc" id="L114">        Set&lt;Typified&gt; results = emptySet(Typified.class);</span>
<span class="fc" id="L115">        types().list().forEach(type -&gt; {</span>
<span class="fc" id="L116">            String typeName = type.toTypeName().fullName();</span>
<span class="fc" id="L117">            Typified superType = faceNamed(typeName);</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">            if (reportWhetherKnown(&quot;typeHeritage&quot;, superType, typeName)) {</span>
<span class="fc" id="L119">                results.add(superType);</span>
<span class="fc" id="L120">                results.addAll(superType.typeHeritage());</span>
            }
<span class="fc" id="L122">        });</span>

<span class="fc" id="L124">        simpleHeritage().forEach(superType -&gt; {</span>
<span class="fc" id="L125">            String typeName = superType.fullName();</span>
<span class="fc" id="L126">            Typified aType = faceNamed(typeName);</span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">            if (reportWhetherKnown(&quot;typeHeritage&quot;, aType, typeName)) {</span>
<span class="fc" id="L128">                results.addAll(aType.typeHeritage());</span>
            }
<span class="fc" id="L130">        });</span>

<span class="fc" id="L132">        return copyList(results);</span>
    }

<span class="fc" id="L135">    public Face faceScope() { return Face.from(this); }</span>
<span class="fc" id="L136">    public Typified faceNamed(String name) { return faceScope().faceNamed(name); }</span>
<span class="fc" id="L137">    public Typified superior() { return faceScope().superclass(); }</span>

<span class="nc" id="L139">    public List&lt;String&gt; decor() { return notes().classDecor(); }</span>
<span class="fc" id="L140">    public Emission metaDecorators() { return emitItems(emitItem(Static.toLowerCase())); }</span>
<span class="fc" id="L141">    public Emission decorators() { return emitItems(notes().classNotesOnlyDecor()); }</span>

    @Override public List&lt;String&gt; knownTypes() {
<span class="fc" id="L144">        HashSet&lt;String&gt; results = emptySet(String.class);</span>
<span class="fc" id="L145">        results.addAll(types().inferGenerics());</span>
<span class="fc" id="L146">        results.addAll(details().inferGenerics());</span>
<span class="fc" id="L147">        return copyList(results);</span>
    }

<span class="pc bpc" id="L150" title="1 of 2 branches missed.">    @Override public Emission emitItem() { return hasSuperclass() ? emitClassSignature() : emitNilSubclassSignature(); }</span>
    @Override public Emission emitMetaItem() {
<span class="fc" id="L152">        return emitClassSignature(metaDecorators(), MetaclassType, NoValue, superMetaClass(), metaFaces()); }</span>

    private Emission emitClassSignature() {
<span class="fc" id="L155">        return emitClassSignature(decorators(), subclassName(), details().emitDetails(true), superClass(), faces()); }</span>

    private Emission emitNilSubclassSignature() {
<span class="nc" id="L158">        return emitNilSubclassSignature(decorators(), subclassName(), details().emitItem(), faces()); }</span>

} // ClassSignature
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>